<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Central Radmin VPN</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
:root {
--bg: #0B1120; --sidebar: #1C2333; --card: #1E293B; --card-hover: #2A3647;
--primary: #06B6D4; --primary-dark: #0891B2; --accent: #8B5CF6;
--text: #F1F5F9; --text2: #94A3B8; --text3: #64748B; --border: #334155;
--green: #10B981; --red: #EF4444; --yellow: #F59E0B;
}
body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
.app { display: flex; height: 100vh; }

/* SIDEBAR MODERNA */
.sidebar { width: 280px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid var(--border); transition: width 0.3s; }
.sidebar.collapsed { width: 70px; }
.sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.logo { display: flex; align-items: center; gap: 12px; }
.logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1em; font-weight: 700; color: #000; }
.logo-text { font-size: 1em; font-weight: 700; white-space: nowrap; }
.sidebar.collapsed .logo-text, .sidebar.collapsed .nav-label, .sidebar.collapsed .nav-item span { display: none; }
.toggle-btn { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 1.2em; }
.nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
.nav-section { margin-bottom: 24px; }
.nav-label { font-size: 0.7em; text-transform: uppercase; color: var(--text3); padding: 0 12px; margin-bottom: 8px; font-weight: 600; }
.nav-item { padding: 12px 16px; margin-bottom: 4px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 0.9em; transition: all 0.2s; color: var(--text2); }
.nav-item:hover { background: rgba(6,182,212,0.1); color: var(--text); }
.nav-item.active { background: linear-gradient(90deg, rgba(6,182,212,0.2), rgba(139,92,246,0.1)); color: var(--text); font-weight: 600; border-left: 3px solid var(--primary); padding-left: 13px; }
.nav-icon { font-size: 1.2em; min-width: 20px; }

/* MAIN */
.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.topbar { background: var(--sidebar); padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.topbar-left { display: flex; gap: 12px; align-items: center; }
.search-box { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 8px 16px; display: flex; align-items: center; gap: 8px; width: 300px; }
.search-box input { background: none; border: none; color: var(--text); outline: none; flex: 1; font-size: 0.85em; }
.status-badge { padding: 6px 14px; border-radius: 20px; font-size: 0.75em; font-weight: 600; }
.status-online { background: rgba(16,185,129,0.15); color: var(--green); }
.status-offline { background: rgba(239,68,68,0.15); color: var(--red); }
.content { flex: 1; overflow-y: auto; padding: 24px; }
.page { display: none; }
.page.active { display: block; }

/* STATS GRID */
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
.stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.stat-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
.stat-icon { width: 44px; height: 44px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2em; }
.stat-label { font-size: 0.8em; color: var(--text2); margin-bottom: 6px; }
.stat-value { font-size: 1.8em; font-weight: 700; }

/* SERVER CARDS */
.servers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 16px; }
.server-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; }
.server-card:hover { border-color: var(--primary); background: var(--card-hover); }
.server-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
.server-name { font-weight: 600; font-size: 1em; }
.server-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.7em; font-weight: 600; }
.badge-online { background: rgba(16,185,129,0.15); color: var(--green); }
.badge-offline { background: rgba(239,68,68,0.15); color: var(--red); }
.server-motd { font-size: 0.85em; color: var(--text2); margin-bottom: 12px; }
.server-footer { display: flex; gap: 16px; font-size: 0.8em; color: var(--text3); }
.server-info { display: flex; align-items: center; gap: 6px; }

/* CHAT */
.chat-container { background: var(--card); border: 1px solid var(--border); border-radius: 12px; }
.chat-header { padding: 20px; border-bottom: 1px solid var(--border); }
.chat-title { font-size: 1.1em; font-weight: 600; margin-bottom: 16px; }
.chat-filters { display: flex; gap: 12px; flex-wrap: wrap; }
.filter-input { flex: 1; min-width: 200px; background: var(--sidebar); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 8px; font-size: 0.85em; }
.filter-input:focus { outline: none; border-color: var(--primary); }
.chat-tabs { display: flex; gap: 4px; margin-top: 16px; border-bottom: 1px solid var(--border); }
.chat-tab { padding: 10px 20px; cursor: pointer; font-size: 0.85em; color: var(--text3); border-bottom: 2px solid transparent; transition: all 0.2s; }
.chat-tab:hover { color: var(--text); }
.chat-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
.chat-body { padding: 20px; max-height: 500px; overflow-y: auto; }
.chat-msg { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.85em; }
.chat-msg:hover { background: var(--card-hover); }
.chat-meta { font-size: 0.75em; color: var(--text3); margin-bottom: 4px; }
.chat-user { color: var(--primary); font-weight: 600; }
.chat-text { color: var(--text); }
.chat-empty { text-align: center; padding: 60px; color: var(--text3); }

/* MODAL */
.modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: var(--card); border: 1px solid var(--border); border-radius: 14px; width: 90%; max-width: 900px; max-height: 85vh; overflow-y: auto; }
.modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.modal-title { font-size: 1.3em; font-weight: 700; }
.close-btn { background: none; border: none; color: var(--text3); font-size: 1.5em; cursor: pointer; }
.modal-body { padding: 24px; }
.modal-section { margin-bottom: 24px; }
.modal-section-title { font-size: 0.9em; color: var(--text2); margin-bottom: 12px; font-weight: 600; }
.info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
.info-item { background: var(--sidebar); padding: 12px; border-radius: 8px; }
.info-label { font-size: 0.75em; color: var(--text3); margin-bottom: 4px; }
.info-value { font-size: 0.9em; color: var(--text); font-weight: 500; }
.players-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.player-item { background: var(--sidebar); padding: 8px 12px; border-radius: 8px; font-size: 0.85em; display: flex; justify-content: space-between; }

/* BUTTONS */
.btn { padding: 10px 18px; border: none; border-radius: 10px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: all 0.2s; }
.btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); color: #fff; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(6,182,212,0.3); }
.btn-secondary { background: var(--card); color: var(--text); border: 1px solid var(--border); }
.btn-sm { padding: 6px 12px; font-size: 0.75em; }
.toast { position: fixed; bottom: 24px; right: 24px; background: var(--card); border: 1px solid var(--primary); padding: 16px 24px; border-radius: 12px; z-index: 3000; animation: slideIn 0.3s; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
@keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.empty { text-align: center; padding: 60px 20px; color: var(--text3); }
@media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .servers-grid { grid-template-columns: 1fr; } }
@media (max-width: 768px) { .sidebar { width: 70px; } .sidebar.collapsed { width: 70px; } .stats-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<div class="app">
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="logo">
<div class="logo-icon">CRV</div>
<div class="logo-text">Central Radmin VPN</div>
</div>
<button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
</div>
<div class="nav">
<div class="nav-section">
<div class="nav-label">Menu</div>
<div class="nav-item active" onclick="switchPage('dashboard')">
<span class="nav-icon">üìä</span><span>Dashboard</span>
</div>
<div class="nav-item" onclick="switchPage('servers')">
<span class="nav-icon">üåê</span><span>Servidores</span>
</div>
<div class="nav-item" onclick="switchPage('chat-live')">
<span class="nav-icon">üí¨</span><span>Chat Ao Vivo</span>
</div>
<div class="nav-item" onclick="switchPage('chat-archive')">
<span class="nav-icon">üì¶</span><span>Chat Arquivado</span>
</div>
</div>
</div>
</div>
<div class="main">
<div class="topbar">
<div class="topbar-left">
<div class="search-box">
<span>üîç</span>
<input type="text" placeholder="Buscar..." id="global-search">
</div>
</div>
<div style="display:flex;gap:12px;align-items:center;">
<div class="status-badge status-offline" id="status-badge">‚ö†Ô∏è Offline</div>
<button class="btn btn-primary" onclick="document.getElementById('connect-modal').style.display='flex'">Conectar</button>
</div>
</div>
<div class="content">

<!-- DASHBOARD -->
<div class="page active" id="page-dashboard">
<div class="stats-grid">
<div class="stat-card">
<div class="stat-header">
<div class="stat-icon">üìä</div>
</div>
<div class="stat-label">Bots Ativos</div>
<div class="stat-value" id="stat-bots">0</div>
</div>
<div class="stat-card">
<div class="stat-header">
<div class="stat-icon">üåê</div>
</div>
<div class="stat-label">Servidores</div>
<div class="stat-value" id="stat-servers">0</div>
</div>
<div class="stat-card">
<div class="stat-header">
<div class="stat-icon">üí¨</div>
</div>
<div class="stat-label">Mensagens</div>
<div class="stat-value" id="stat-msgs">0</div>
</div>
<div class="stat-card">
<div class="stat-header">
<div class="stat-icon">üö´</div>
</div>
<div class="stat-label">Blacklist</div>
<div class="stat-value" id="stat-bl">0</div>
</div>
</div>
</div>

<!-- SERVIDORES -->
<div class="page" id="page-servers">
<h2 style="margin-bottom:20px;">Servidores Detectados</h2>
<div class="servers-grid" id="servers-list">
<div class="empty">Nenhum servidor detectado</div>
</div>
</div>

<!-- CHAT AO VIVO -->
<div class="page" id="page-chat-live">
<div class="chat-container">
<div class="chat-header">
<div class="chat-title">üí¨ Database de Chat (Ao Vivo)</div>
<div class="chat-filters">
<select class="filter-input" id="filter-server-live">
<option value="">Todos os servidores</option>
</select>
<input class="filter-input" placeholder="Buscar por jogador ou mensagem..." id="filter-search-live">
<button class="btn btn-secondary btn-sm" onclick="filterChat('live')">Buscar</button>
<button class="btn btn-primary btn-sm" onclick="emit('saveChat')">üíæ Salvar</button>
</div>
</div>
<div class="chat-body" id="chat-live-body">
<div class="chat-empty">Sem mensagens</div>
</div>
</div>
</div>

<!-- CHAT ARQUIVADO -->
<div class="page" id="page-chat-archive">
<div class="chat-container">
<div class="chat-header">
<div class="chat-title">üì¶ Chat Arquivado</div>
<div class="chat-filters">
<select class="filter-input" id="filter-server-archive">
<option value="">Todos os servidores</option>
</select>
<input class="filter-input" placeholder="Buscar por jogador ou mensagem..." id="filter-search-archive">
<button class="btn btn-secondary btn-sm" onclick="filterChat('archive')">Buscar</button>
<button class="btn btn-secondary btn-sm" onclick="exportCSV()">üì• CSV</button>
</div>
</div>
<div class="chat-body" id="chat-archive-body">
<div class="chat-empty">Sem mensagens arquivadas</div>
</div>
</div>
</div>

</div>
</div>
</div>

<!-- MODAL SERVIDOR -->
<div class="modal" id="server-modal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title" id="modal-server-title">Servidor</div>
<button class="close-btn" onclick="closeModal()">&times;</button>
</div>
<div class="modal-body">
<div class="modal-section">
<div class="modal-section-title">Informa√ß√µes</div>
<div class="info-grid">
<div class="info-item">
<div class="info-label">IP:Porta</div>
<div class="info-value" id="modal-ip">-</div>
</div>
<div class="info-item">
<div class="info-label">MOTD</div>
<div class="info-value" id="modal-motd">-</div>
</div>
<div class="info-item">
<div class="info-label">Status</div>
<div class="info-value" id="modal-status">-</div>
</div>
<div class="info-item">
<div class="info-label">Jogadores Online</div>
<div class="info-value" id="modal-players-count">0</div>
</div>
</div>
</div>
<div class="modal-section">
<div class="modal-section-title">Jogadores Online</div>
<div class="players-list" id="modal-players-list">
<div class="chat-empty">Nenhum jogador</div>
</div>
</div>
<div class="modal-section">
<div class="modal-section-title">Chat em Tempo Real</div>
<div class="chat-body" style="max-height:300px;" id="modal-chat">
<div class="chat-empty">Sem mensagens recentes</div>
</div>
</div>
</div>
</div>
</div>

<!-- MODAL CONECTAR -->
<div class="modal" id="connect-modal">
<div class="modal-content" style="max-width:500px;">
<div class="modal-header">
<div class="modal-title">Conectar ao Relay</div>
<button class="close-btn" onclick="closeModal()">&times;</button>
</div>
<div class="modal-body">
<input class="filter-input" style="width:100%;margin-bottom:20px;" id="relay-url" placeholder="https://seu-relay.onrender.com" value="https://anunciador-relay.onrender.com">
<div style="display:flex;gap:12px;">
<button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
<button class="btn btn-primary" onclick="conectar();closeModal()">Conectar</button>
</div>
</div>
</div>
</div>

<script>
let socket=null,pcOn=false,servers=[],chatLive=[],chatArchive=[],currentServerKey=null;

function conectar(){
const url=document.getElementById('relay-url').value.trim();
if(!url){toast('Cole URL!');return;}
localStorage.setItem('relayUrl',url);
if(socket){socket.disconnect();socket=null;}
socket=io(url,{reconnection:true});
socket.on('connect',()=>{
document.getElementById('status-badge').className='status-badge status-online';
document.getElementById('status-badge').textContent='‚úÖ Online';
});
socket.on('disconnect',()=>{
document.getElementById('status-badge').className='status-badge status-offline';
document.getElementById('status-badge').textContent='‚ö†Ô∏è Offline';
pcOn=false;
});
socket.on('botStatus',on=>{pcOn=on;});
socket.on('init',d=>{
updateStats(d.stats||{});
if(d.servers)servers=d.servers;
if(d.chatDatabase)chatLive=d.chatDatabase;
renderServers();renderChatLive();updateServerFilters();
});
socket.on('serverUpdate',s=>{servers=s;renderServers();});
socket.on('chatMessage',m=>{chatLive.push(m);if(chatLive.length>5000)chatLive.shift();renderChatLive();});
socket.on('toast',toast);
}

function updateStats(s){
document.getElementById('stat-bots').textContent=s.botsAtivos||0;
document.getElementById('stat-msgs').textContent=(s.mensagens||[]).length;
document.getElementById('stat-bl').textContent=s.blacklistSize||0;
document.getElementById('stat-servers').textContent=servers.length;
}

function renderServers(){
const c=document.getElementById('servers-list');
if(!servers.length){c.innerHTML='<div class="empty">Nenhum servidor detectado</div>';return;}
c.innerHTML=servers.map(s=>`
<div class="server-card" onclick="openServerModal('${s.key}')">
<div class="server-header">
<div class="server-name">${s.key}</div>
<div class="server-badge ${s.status==='online'?'badge-online':'badge-offline'}">${s.status==='online'?'ONLINE':'OFFLINE'}</div>
</div>
<div class="server-motd">${esc(s.motd||'???')}</div>
<div class="server-footer">
<div class="server-info">üë• ${(s.players||[]).length} jogadores</div>
<div class="server-info">üì° ${s.ping||'?'}ms</div>
<div class="server-info">üìç v${s.version||'?'}</div>
</div>
</div>
`).join('');
}

function renderChatLive(){
const c=document.getElementById('chat-live-body');
if(!chatLive.length){c.innerHTML='<div class="chat-empty">Sem mensagens</div>';return;}
c.innerHTML=chatLive.slice(-100).reverse().map(m=>`
<div class="chat-msg">
<div class="chat-meta">[${m.time}] [${m.serverKey}]</div>
<div><span class="chat-user">${esc(m.username)}</span>: <span class="chat-text">${esc(m.message)}</span></div>
</div>
`).join('');
}

function filterChat(type){
const serverFilter=document.getElementById(`filter-server-${type}`).value;
const searchText=document.getElementById(`filter-search-${type}`).value.toLowerCase();
let data=type==='live'?chatLive:chatArchive;
if(serverFilter)data=data.filter(m=>m.serverKey.includes(serverFilter));
if(searchText)data=data.filter(m=>m.username.toLowerCase().includes(searchText)||m.message.toLowerCase().includes(searchText)||m.serverKey.toLowerCase().includes(searchText));
const c=document.getElementById(`chat-${type}-body`);
if(!data.length){c.innerHTML='<div class="chat-empty">Nenhuma mensagem encontrada</div>';return;}
c.innerHTML=data.slice(-500).reverse().map(m=>`
<div class="chat-msg">
<div class="chat-meta">[${m.time}] [${m.serverKey}]</div>
<div><span class="chat-user">${esc(m.username)}</span>: <span class="chat-text">${esc(m.message)}</span></div>
</div>
`).join('');
}

function openServerModal(key){
currentServerKey=key;
const s=servers.find(x=>x.key===key);
if(!s)return;
document.getElementById('modal-server-title').textContent=key;
document.getElementById('modal-ip').textContent=key;
document.getElementById('modal-motd').textContent=s.motd||'???';
document.getElementById('modal-status').textContent=s.status||'unknown';
document.getElementById('modal-players-count').textContent=(s.players||[]).length;
const pl=document.getElementById('modal-players-list');
if(!s.players||!s.players.length){pl.innerHTML='<div class="chat-empty">Nenhum jogador</div>';}
else{pl.innerHTML=s.players.map(p=>`<div class="player-item"><span>${esc(p.name)}</span><span>${p.ping}ms</span></div>`).join('');}
const msgs=chatLive.filter(m=>m.serverKey===key).slice(-30);
const ch=document.getElementById('modal-chat');
if(!msgs.length){ch.innerHTML='<div class="chat-empty">Sem mensagens</div>';}
else{ch.innerHTML=msgs.map(m=>`<div class="chat-msg"><div class="chat-meta">[${m.time}]</div><div><span class="chat-user">${esc(m.username)}</span>: <span class="chat-text">${esc(m.message)}</span></div></div>`).join('');}
document.getElementById('server-modal').classList.add('active');
}

function updateServerFilters(){
const opts=servers.map(s=>`<option value="${s.key}">${s.key}</option>`).join('');
document.getElementById('filter-server-live').innerHTML='<option value="">Todos os servidores</option>'+opts;
document.getElementById('filter-server-archive').innerHTML='<option value="">Todos os servidores</option>'+opts;
}

function exportCSV(){
let csv='Data,Hora,Servidor,Jogador,Mensagem\n';
chatArchive.forEach(m=>{csv+=`${m.date},${m.time},${m.serverKey},${m.username},"${m.message.replace(/"/g,'""')}"\n`;});
const blob=new Blob([csv],{type:'text/csv'});
const link=document.createElement('a');
link.download=`chat-${Date.now()}.csv`;
link.href=URL.createObjectURL(blob);
link.click();
toast('CSV exportado!');
}

function switchPage(p){
document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
document.getElementById(`page-${p}`).classList.add('active');
document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
event.target.closest('.nav-item').classList.add('active');
}

function toggleSidebar(){document.getElementById('sidebar').classList.toggle('collapsed');}
function closeModal(){document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'));}
function emit(ev,data){if(!socket?.connected){toast('Conecte!');return;}if(!pcOn){toast('Bot offline!');return;}socket.emit(ev,data);}
function toast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),3000);}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}

const savedUrl=localStorage.getItem('relayUrl')||'https://anunciador-relay.onrender.com';
document.getElementById('relay-url').value=savedUrl;
setTimeout(conectar,500);
</script>
</body>
</html>